<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PI NEBULA PRO - V58</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;700&family=Montserrat:wght@900&display=swap" rel="stylesheet">
    
    <style>
        :root { 
            --bg-deep: #4c3ba5; 
            --bg-mine: #0a0a0a; 
            --yellow: #fbc02d; 
            --neon: #8eff31; 
            --glass: rgba(255, 255, 255, 0.1);
        }

        * { margin:0; padding:0; box-sizing:border-box; font-family: 'Fredoka', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg-deep); color: white; overflow: hidden; height: 100vh; }

        /* --- SAYFA YAPISI --- */
        .view { display: none; height: 100vh; flex-direction: column; padding: 20px; overflow-y: auto; padding-bottom: 110px; }
        .view.active { display: flex; }

        /* --- ANA EKRAN (HOME) --- */
        #v-home { align-items: center; justify-content: center; text-align: center; background-image: radial-gradient(circle at 50% 30%, #5e48c2 0%, #2c1a74 100%); }
        .hero-img { width: 220px; filter: drop-shadow(0 15px 30px rgba(0,0,0,0.5)); margin-bottom: 20px; }
        .bal-display { font-family: 'Montserrat'; font-size: 2.5rem; color: var(--yellow); margin-bottom: 25px; }

        /* --- MINING EKRANI --- */
        #v-mining { background: var(--bg-mine); align-items: center; justify-content: space-between; padding: 40px 20px; z-index: 2000; position: fixed; top:0; left:0; width: 100%; }
        .fan-box { position: relative; width: 240px; height: 240px; display: flex; align-items: center; justify-content: center; }
        .pinix-fan { width: 100%; height: 100%; border-radius: 50%; border: 5px solid var(--neon); box-shadow: 0 0 40px rgba(142,255,49,0.2); object-fit: cover; }
        .spinning { animation: rotateFan 1.2s linear infinite; }
        @keyframes rotateFan { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* --- SEKMELERE √ñZEL KARTLAR --- */
        .card { background: var(--glass); padding: 18px; border-radius: 20px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.1); width: 100%; }
        .card h3 { color: var(--yellow); margin-bottom: 5px; font-size: 1.1rem; }
        .card p { font-size: 0.85rem; opacity: 0.8; }

        /* --- ALT NAVƒ∞GASYON (G√ñRSELDEKƒ∞ Gƒ∞Bƒ∞) --- */
        nav { 
            position: fixed; bottom: 0; width: 100%; height: 95px; 
            background: rgba(44, 26, 116, 0.9); backdrop-filter: blur(15px);
            display: flex; justify-content: space-around; align-items: center;
            border-top: 1px solid rgba(255,255,255,0.1); border-radius: 30px 30px 0 0;
            z-index: 1000;
        }
        .nav-item { text-align: center; opacity: 0.4; color: white; font-size: 0.75rem; transition: 0.3s; }
        .nav-item.active { opacity: 1; color: var(--yellow); }
        .nav-item div { font-size: 1.6rem; margin-bottom: 3px; }

        /* --- BUTONLAR --- */
        .btn { width: 85%; padding: 18px; border: none; border-radius: 50px; font-size: 1.4rem; font-weight: 700; cursor: pointer; transition: 0.2s; }
        .btn-play { background: var(--yellow); color: #2c1a74; box-shadow: 0 6px 0 #9e7500; }
        .btn-stop { background: #ff3131; color: white; box-shadow: 0 6px 0 #b2102f; }
        .btn:active { transform: translateY(3px); box-shadow: none; }

        /* STATS GRID */
        .mining-stats { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; width: 100%; margin: 20px 0; }
        .stat-card { background: var(--glass); border: 1px solid rgba(255,255,255,0.1); padding: 12px 5px; border-radius: 15px; text-align: center; }
        .st-val { color: var(--neon); font-family: 'Montserrat'; font-size: 0.9rem; font-weight: 900; }
        .st-lbl { font-size: 0.6rem; opacity: 0.5; text-transform: uppercase; }

        header { position: fixed; top: 15px; width: 100%; padding: 0 20px; display: flex; justify-content: space-between; z-index: 100; }
        .badge { background: rgba(0,0,0,0.5); padding: 5px 12px; border-radius: 12px; font-size: 0.75rem; border: 1px solid rgba(255,255,255,0.1); }
    </style>
</head>
<body>

<div id="app">
    <header id="ui-header">
        <div class="badge">LVL <span id="u-lvl">1</span></div>
        <div class="badge" style="color:var(--yellow)">Admin: 8392479231</div>
    </header>

    <div id="v-home" class="view active">
        <img src="yourfantastic.jpg" class="hero-img" onerror="this.src='https://via.placeholder.com/220'">
        <h1 style="line-height: 0.85; margin-bottom: 10px;">YOUR<br>FANTASTIC PET</h1>
        <div class="bal-display" id="total-bal">0.00</div>
        <button class="btn btn-play" onclick="startMining()">PLAY / START</button>
    </div>

    <div id="v-mining" style="display:none;">
        <div style="text-align:center;">
            <h2 style="color:var(--neon); letter-spacing:4px;">MINING MODE</h2>
            <p id="mine-cycle-text" style="font-size:0.7rem; opacity:0.5;">Sistem Hazƒ±rlanƒ±yor...</p>
        </div>
        <div class="fan-box">
            <img src="pinix.jpg" id="fan-img" class="pinix-fan spinning" onerror="this.src='https://via.placeholder.com/240'">
        </div>
        <div class="mining-stats">
            <div class="stat-card">
                <span class="st-val" id="st-time">0s</span><br><span class="st-lbl">S√ºre</span>
            </div>
            <div class="stat-card">
                <span class="st-val" id="st-earned">0.0000</span><br><span class="st-lbl">Kazanƒ±lan</span>
            </div>
            <div class="stat-card">
                <span class="st-val" id="st-ghs">0.00</span><br><span class="st-lbl">GH/s</span>
            </div>
        </div>
        <button class="btn btn-stop" onclick="stopMining()">STOP & COLLECT</button>
    </div>

    <div id="v-friends" class="view">
        <h2 style="margin-bottom:20px;">Arkada≈ülarƒ±nƒ± Davet Et</h2>
        <div class="card">
            <h3>Davet Linkin</h3>
            <input type="text" id="ref-link" readonly style="width:100%; background:rgba(0,0,0,0.3); border:none; color:white; padding:10px; border-radius:10px; font-size:0.8rem;">
        </div>
        <div class="card">
            <h3>√ñd√ºller</h3>
            <p>Her arkada≈üƒ±n i√ßin 5 PI kazanƒ±rsƒ±n.</p>
        </div>
    </div>

    <div id="v-tasks" class="view">
        <h2 style="margin-bottom:20px;">G√ºnl√ºk G√∂revler</h2>
        <div class="card" onclick="tg.openLink('https://x.com')">
            <h3>X (Twitter) Takip Et</h3>
            <p>+2.50 PI √ñd√ºl</p>
        </div>
        <div class="card" onclick="tg.openTelegramLink('https://t.me/your_channel')">
            <h3>Telegram Kanalƒ±na Katƒ±l</h3>
            <p>+1.50 PI √ñd√ºl</p>
        </div>
    </div>

    <div id="v-wallet" class="view">
        <h2 style="margin-bottom:20px;">C√ºzdan & √áekim</h2>
        <div class="card">
            <h3>Mevcut Bakiye</h3>
            <div style="font-size: 1.8rem; color: var(--yellow);" id="wallet-bal">0.00 PI</div>
        </div>
        <div class="card">
            <h3>√áekim Adresi</h3>
            <input type="text" placeholder="TON C√ºzdan Adresi" style="width:100%; padding:12px; border-radius:10px; border:none; background:rgba(255,255,255,0.1); color:white;">
        </div>
        <button class="btn btn-play" style="width:100%;" onclick="alert('Minimum √ßekim tutarƒ± 500 PI.')">PARA √áEK</button>
    </div>

    <nav id="bottom-nav">
        <div class="nav-item" onclick="showTab('v-friends', this)"><div>üë•</div>Friends</div>
        <div class="nav-item" onclick="showTab('v-tasks', this)"><div>üéÅ</div>Tasks</div>
        <div class="nav-item active" onclick="showTab('v-home', this)"><div>üêæ</div>Home</div>
        <div class="nav-item" onclick="showTab('v-wallet', this)"><div>üí≥</div>Wallet</div>
    </nav>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyApwj-8tB4qxqe8yJ9uP7XuKfEdT2lwYv4",
        authDomain: "fonix-b4de6.firebaseapp.com",
        projectId: "fonix-b4de6",
        storageBucket: "fonix-b4de6.firebasestorage.app",
        messagingSenderId: "20899545652",
        appId: "1:20899545652:web:f32ef599f0c8d3deaec061"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const tg = window.Telegram.WebApp;

    let uid = tg.initDataUnsafe?.user?.id ? String(tg.initDataUnsafe.user.id) : "dev_test";
    let uData = { pi: 0, lvl: 1 };
    let miningInt = null;
    let seconds = 0;
    let sessionPi = 0;

    function init() {
        tg.expand();
        db.collection("users").doc(uid).onSnapshot(doc => {
            if(doc.exists) { 
                uData = doc.data(); 
                document.getElementById('total-bal').innerText = uData.pi.toFixed(2);
                document.getElementById('wallet-bal').innerText = uData.pi.toFixed(2) + " PI";
                document.getElementById('u-lvl').innerText = uData.lvl || 1;
            } else { 
                db.collection("users").doc(uid).set(uData); 
            }
        });
        document.getElementById('ref-link').value = "https://t.me/BotAdiniz?start=" + uid;
    }

    function showTab(tabId, el) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        if(el) el.classList.add('active');
    }

    function startMining() {
        // Mining ekranƒ±nƒ± g√∂ster, diƒüerlerini gizle
        document.getElementById('v-mining').style.display = 'flex';
        document.getElementById('bottom-nav').style.display = 'none';
        
        seconds = 0; sessionPi = 0;
        document.getElementById('st-time').innerText = "0s";
        document.getElementById('st-earned').innerText = "0.0000";

        miningInt = setInterval(() => {
            seconds++;
            document.getElementById('st-time').innerText = seconds + "s";
            document.getElementById('st-ghs').innerText = (Math.random() * (7 - 1) + 1).toFixed(2);

            let cycle = seconds % 30;
            document.getElementById('mine-cycle-text').innerText = `D√∂ng√º: ${cycle}/30 saniye`;

            if (seconds > 0 && seconds % 30 === 0) {
                let gain = Math.random() * (0.001 - 0.0001) + 0.0001;
                sessionPi += gain;
                document.getElementById('st-earned').innerText = sessionPi.toFixed(4);
                tg.HapticFeedback.notificationOccurred('success');
            }
        }, 1000);
    }

    function stopMining() {
        clearInterval(miningInt);
        db.collection("users").doc(uid).update({
            pi: firebase.firestore.FieldValue.increment(sessionPi)
        }).then(() => {
            document.getElementById('v-mining').style.display = 'none';
            document.getElementById('bottom-nav').style.display = 'flex';
            
            // Stats Sƒ±fƒ±rla
            seconds = 0; sessionPi = 0;
            document.getElementById('st-time').innerText = "0s";
            document.getElementById('st-earned').innerText = "0.0000";
            
            tg.showAlert("Mining durduruldu, kazan√ß hesabƒ±na eklendi!");
        });
    }

    window.onload = init;
</script>
</body>
</html>
