<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fonix Mining v319 Pro</title>
    <script src="https://telegram.org/js/telegram-web-app.js?56"></script>
    <script src="https://adexora.com/cdn/ads.js?id=1701"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, increment, collection, query, where, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCfQGeQUVom6cX8aDyfXdGNly0L1Rlj87I",
            authDomain: "fonixapp.firebaseapp.com",
            projectId: "fonixapp",
            storageBucket: "fonixapp.firebasestorage.app",
            messagingSenderId: "980255542194",
            appId: "1:980255542194:web:883a3f7a8fc05fee6332ab"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const tg = window.Telegram.WebApp;
        tg.expand();

        const user = tg.initDataUnsafe?.user;
        const myID = user?.id ? user.id.toString() : "8392479231"; 
        
        let stats = { usdt: 0, kls: 0 };
        let isMining = false;
        let adProgress = 0;
        let miningTimer;

        async function init() {
            const userRef = doc(db, "users", myID);
            const snap = await getDoc(userRef);
            if (snap.exists()) stats = snap.data();
            else {
                stats = { usdt: 0, username: user?.username || "User", invitedBy: tg.initDataUnsafe?.start_param || "" };
                await setDoc(userRef, stats);
            }
            updateUI();
        }

        function updateUI() {
            document.querySelectorAll('.ui-usdt').forEach(e => e.innerText = stats.usdt.toFixed(5));
        }

        // --- MINING PANEL KONTROL√ú ---
        window.openMining = () => {
            document.getElementById('mining-overlay').style.display = 'flex';
            startMiningLogic();
        };

        window.closeMining = () => {
            stopMiningLogic();
            document.getElementById('mining-overlay').style.display = 'none';
            saveData();
        };

        function startMiningLogic() {
            if(isMining) return;
            isMining = true;
            miningTimer = setInterval(() => {
                stats.usdt += 0.00005;
                adProgress += 3.33; // 30 saniyede bir %100 olur
                
                document.getElementById('prog-bar').style.width = adProgress + "%";
                document.getElementById('live-earn').innerText = stats.usdt.toFixed(5);
                
                if(adProgress >= 100) {
                    stopMiningLogic();
                    triggerAd();
                }
                updateUI();
            }, 1000);
        }

        function stopMiningLogic() {
            isMining = false;
            clearInterval(miningTimer);
        }

        function triggerAd() {
            window.showAdexora().then(async () => {
                adProgress = 0;
                await saveData();
                startMiningLogic();
            }).catch(() => {
                tg.showAlert("Ad error! Retrying...");
                adProgress = 90;
                startMiningLogic();
            });
        }

        async function saveData() {
            await updateDoc(doc(db, "users", myID), { usdt: stats.usdt });
        }

        window.showTab = (t, b) => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('p-' + t).classList.add('active');
            document.querySelectorAll('.n-btn').forEach(btn => btn.classList.remove('n-on'));
            b.classList.add('n-on');
        };

        window.onload = init;
    </script>
    <style>
        :root { --p: #6c5ce7; --y: #f7d348; --d: #08080c; --card: rgba(255,255,255,0.06); }
        body { margin: 0; background: var(--d); color: #fff; font-family: 'Inter', sans-serif; overflow: hidden; user-select: none; }
        #app { height: 100vh; display: flex; flex-direction: column; }
        .page { display: none; flex: 1; padding: 20px; overflow-y: auto; }
        .active { display: flex; flex-direction: column; }
        
        /* Dashboard Tasarƒ±mƒ± */
        .card { background: var(--card); border-radius: 20px; padding: 20px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 15px; }
        .hero-card { background: linear-gradient(135deg, var(--p), #3b2fad); border: none; position: relative; overflow: hidden; }
        .hero-card::after { content: ''; position: absolute; top: -50%; right: -20%; width: 150px; height: 150px; background: rgba(255,255,255,0.1); border-radius: 50%; }

        /* Mining Overlay */
        #mining-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: var(--d); z-index: 100; display: none; flex-direction: column; padding: 30px; box-sizing: border-box; }
        .mining-circle { width: 180px; height: 180px; border-radius: 50%; border: 4px solid var(--y); margin: 40px auto; display: flex; align-items: center; justify-content: center; position: relative; animation: pulse 2s infinite; }
        .prog-container { width: 100%; height: 8px; background: #222; border-radius: 10px; margin: 20px 0; overflow: hidden; }
        #prog-bar { height: 100%; width: 0%; background: var(--y); transition: 0.3s; }

        .btn { width: 100%; background: var(--y); color: #000; border: none; padding: 18px; border-radius: 16px; font-weight: 800; cursor: pointer; text-transform: uppercase; }
        .nav { height: 75px; background: rgba(0,0,0,0.9); display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #222; }
        .n-btn { background: none; border: none; color: #fff; opacity: 0.4; font-size: 10px; }
        .n-on { opacity: 1; color: var(--y); }

        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(247, 211, 72, 0.4); } 70% { box-shadow: 0 0 0 20px rgba(247, 211, 72, 0); } 100% { box-shadow: 0 0 0 0 rgba(247, 211, 72, 0); } }
    </style>
</head>
<body>
<div id="app">
    <div id="p-home" class="page active">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
            <div><small style="opacity:0.5;">Welcome back,</small><br><b>Fonix Miner</b></div>
            <img src="koalasmining.jpg" style="width: 45px; border-radius: 12px; border: 2px solid var(--y);">
        </div>

        <div class="card hero-card">
            <small style="opacity: 0.8;">TOTAL ASSETS</small>
            <h1 style="font-size: 40px; margin: 5px 0;">$<span class="ui-usdt">0.00000</span></h1>
            <div style="font-size: 12px; background: rgba(0,0,0,0.2); padding: 5px 10px; border-radius: 20px; display: inline-block;">
                Status: Professional Miner ‚úÖ
            </div>
        </div>

        <div class="card" style="text-align: center;">
            <p style="font-size: 14px; opacity: 0.7;">Ready to start your daily session?</p>
            <button class="btn" onclick="openMining()">üöÄ Play Mining</button>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div class="card" style="margin:0; padding:15px;"><small>Hashrate</small><br><b>45.2 MH/s</b></div>
            <div class="card" style="margin:0; padding:15px;"><small>Efficiency</small><br><b style="color:#2ed573;">99.4%</b></div>
        </div>
    </div>

    <div id="mining-overlay">
        <div style="display: flex; justify-content: space-between;">
            <b style="color: var(--y);">LIVE MINING</b>
            <button onclick="closeMining()" style="background:none; border:none; color:#fff; font-size: 20px;">‚úï</button>
        </div>

        <div class="mining-circle">
            <div style="text-align: center;">
                <small style="opacity:0.6;">Current Session</small><br>
                <b style="font-size: 22px;">$<span id="live-earn">0.00000</span></b>
            </div>
        </div>

        <div class="card" style="background:rgba(255,255,255,0.02);">
            <div style="display:flex; justify-content:space-between; font-size:13px; margin-bottom:10px;">
                <span>Next Bonus Ad</span>
                <span id="prog-text">Progress</span>
            </div>
            <div class="prog-container">
                <div id="prog-bar"></div>
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; font-size: 12px; opacity: 0.7; margin-top: 15px;">
                <span>üå°Ô∏è Temp: 42¬∞C</span>
                <span>‚ö° Power: 120W</span>
                <span>üõ∞Ô∏è Node: Istanbul</span>
                <span>üîó Ping: 12ms</span>
            </div>
        </div>

        <p style="text-align:center; font-size: 11px; opacity:0.4; margin-top: auto;">
            Mining utilizes cloud nodes. Keep the app open for maximum rewards.
        </p>
    </div>

    <div id="p-friends" class="page">
        <h2>Network</h2>
        <div class="card">
            <small style="color:var(--p);">YOUR REFERRAL LINK</small>
            <div id="ref-link" style="font-size: 10px; background:#000; padding:15px; border-radius:12px; margin:10px 0; color:#555; word-break:all;"></div>
            <button class="btn" style="padding:12px; font-size:14px;" onclick="navigator.clipboard.writeText(document.getElementById('ref-link').innerText); tg.showAlert('Copied!')">Copy Link</button>
        </div>
    </div>

    <div id="p-wallet" class="page">
        <h2>Wallet</h2>
        <div class="card">
            <input type="number" id="w-amt" placeholder="Amount ($10 Min)" style="width:100%; padding:15px; margin-bottom:10px; background:#000; color:#fff; border:1px solid #333; border-radius:12px;">
            <input type="text" placeholder="USDT (TON) Address" style="width:100%; padding:15px; margin-bottom:10px; background:#000; color:#fff; border:1px solid #333; border-radius:12px;">
            <button class="btn" onclick="tg.showAlert('Reviewing request...')">Withdraw Funds</button>
        </div>
    </div>

    <nav class="nav">
        <button class="n-btn n-on" onclick="showTab('home', this)">üè†<br>Hub</button>
        <button class="n-btn" onclick="showTab('friends', this)">üë•<br>Ref</button>
        <button class="n-btn" onclick="showTab('wallet', this)">üí∞<br>Wallet</button>
    </nav>
</div>
</body>
</html>
