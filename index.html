<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEBULA USDT MINER</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;700&family=Montserrat:wght@900&display=swap" rel="stylesheet">
    
    <style>
        :root { 
            --bg-main: #4c3ba5; --bg-dark: #0a0a0a; --bg-card: #1e293b; 
            --accent: #00ff88; --yellow: #fbc02d; --usdt: #26a17b;
        }

        * { margin:0; padding:0; box-sizing:border-box; font-family: 'Fredoka', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg-main); color: white; overflow: hidden; height: 100vh; }

        .view { display: none; height: 100vh; flex-direction: column; padding: 25px; overflow-y: auto; padding-bottom: 110px; }
        .view.active { display: flex; }

        /* --- HOME (ESKİ HALİ) --- */
        #v-home { align-items: center; justify-content: center; text-align: center; background: radial-gradient(circle at 50% 30%, #5e48c2 0%, #1a1a2e 100%); }
        .hero-img { width: 190px; filter: drop-shadow(0 0 20px rgba(0,255,136,0.2)); margin-bottom: 15px; }
        .bal-display { font-family: 'Montserrat'; font-size: 3rem; color: var(--accent); margin-bottom: 25px; display: flex; align-items: center; gap: 8px; }

        /* --- MINING ENGINE --- */
        #v-mining { position: fixed; top:0; left:0; width:100%; height:100%; background: var(--bg-dark); z-index: 5000; display:none; flex-direction:column; align-items:center; justify-content:space-around; padding:40px; }
        .fan-container { position: relative; width: 260px; height: 260px; }
        .fan-spin { width: 100%; height: 100%; border-radius: 50%; border: 8px solid #222; animation: rotate 1.2s linear infinite; box-shadow: 0 0 40px rgba(0,255,136,0.1); }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* --- TASKS --- */
        .task-card { background: rgba(255,255,255,0.06); padding: 18px; border-radius: 20px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; }
        .task-reward { color: var(--accent); font-weight: 700; }

        /* --- DRAWERS (TASKS & WITHDRAW) --- */
        .drawer { position: fixed; bottom: 0; left: 0; width: 100%; background: #161b22; border-top: 4px solid var(--accent); border-radius: 30px 30px 0 0; padding: 30px; z-index: 6000; transform: translateY(100%); transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .drawer.open { transform: translateY(0); }
        .input-box { width: 100%; background: #0d1117; border: 1px solid #30363d; padding: 15px; border-radius: 12px; color: white; margin-bottom: 15px; font-size: 1rem; }

        /* --- NAV --- */
        nav { position: fixed; bottom: 0; width: 100%; height: 90px; background: rgba(10,10,10,0.9); backdrop-filter: blur(15px); display: flex; justify-content: space-around; align-items: center; z-index: 1000; }
        .nav-item { text-align: center; opacity: 0.4; font-size: 0.7rem; color: white; }
        .nav-item.active { opacity: 1; color: var(--accent); }

        .btn-main { width: 100%; padding: 18px; border: none; border-radius: 50px; font-size: 1.2rem; font-weight: 900; cursor: pointer; }
        .btn-green { background: var(--accent); color: black; }
        .btn-red { background: #ff3131; color: white; margin-top: 10px; }
    </style>
</head>
<body>

    <header style="position:fixed; top:15px; width:100%; display:flex; justify-content:space-between; padding:0 25px; z-index:100;">
        <div style="background:rgba(0,0,0,0.5); padding:6px 15px; border-radius:20px; font-size:0.7rem; border:1px solid var(--accent);">ID: 8392479231</div>
        <div style="background:var(--usdt); color:white; padding:6px 15px; border-radius:20px; font-size:0.7rem; font-weight:700;">USDT TRC20</div>
    </header>

    <div id="v-home" class="view active">
        <img src="yourfantastic.jpg" class="hero-img" onerror="this.src='https://via.placeholder.com/190'">
        <h2 style="font-size:1.8rem;">FANTASTIC PET</h2>
        <div class="bal-display"><span id="total-bal">0.00</span> <small style="font-size:1rem;">USDT</small></div>
        <button class="btn-main btn-green" style="width:80%;" onclick="startMining()">MINING'I BAŞLAT</button>
    </div>

    <div id="v-tasks" class="view">
        <h2 style="margin-bottom:20px;">GÖREVLER</h2>
        <div class="task-card">
            <div><h4>Örnek Görev #1</h4><p style="font-size:0.7rem; opacity:0.6;">Telegram Katılımı</p></div>
            <div class="task-reward">0.50$</div>
            <button onclick="openTask('Örnek Görev #1', 0.50)" style="padding:8px 15px; border-radius:10px; background:var(--accent); border:none; font-weight:700;">YAP</button>
        </div>
        </div>

    <div id="v-wallet" class="view">
        <h2 style="margin-bottom:10px;">PARA ÇEK</h2>
        <p style="font-size:0.8rem; opacity:0.6; margin-bottom:20px;">Minimum Çekim: 5.00 USDT</p>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
            <div onclick="openWithdraw('Binance')" style="background:var(--bg-card); padding:20px; border-radius:15px; text-align:center;"><b>Binance</b></div>
            <div onclick="openWithdraw('Bybit')" style="background:var(--bg-card); padding:20px; border-radius:15px; text-align:center;"><b>Bybit</b></div>
        </div>
    </div>

    <div id="v-mining">
        <h2 style="color:var(--accent)">USDT MINING</h2>
        <div class="fan-container">
            <img src="pinix.jpg" class="fan-spin" onerror="this.src='https://via.placeholder.com/260'">
        </div>
        <div style="text-align:center;">
            <div style="font-size:0.9rem; opacity:0.5;">EARNINGS</div>
            <div id="m-earned" style="font-size:3rem; color:var(--accent); font-family:'Montserrat'">0.0000</div>
        </div>
        <button class="btn-main btn-red" onclick="stopMining()">KAZANCI TOPLA</button>
    </div>

    <div id="task-drawer" class="drawer">
        <h3 id="td-title" style="color:var(--yellow)">GÖREV</h3>
        <p style="margin:15px 0; opacity:0.8;">Aşağıdaki butona basarak görevi tamamlayın. Kontrol edildikten sonra ödülünüz eklenecektir.</p>
        <div style="background:#000; padding:15px; border-radius:15px; text-align:center; margin-bottom:20px;">
            Ödül: <span id="td-reward" style="color:var(--accent); font-weight:700;">0 USDT</span>
        </div>
        <button class="btn-main btn-green" onclick="completeTask()">GÖREVİ TAMAMLA</button>
        <button onclick="closeDrawer()" style="width:100%; background:none; border:none; color:white; margin-top:15px; opacity:0.4;">Vazgeç</button>
    </div>

    <div id="withdraw-drawer" class="drawer">
        <h3 id="wd-title">USDT ÇEKİM</h3>
        <p style="margin:10px 0 20px; font-size:0.8rem; opacity:0.6;">Lütfen USDT TRC20 ağını kullandığınızdan emin olun.</p>
        <input type="text" id="trc20-addr" class="input-box" placeholder="TRC20 Adresini Yapıştır">
        <input type="number" id="wd-amount" class="input-box" placeholder="Miktar (Örn: 5.00)">
        <button class="btn-main btn-green" onclick="confirmWithdraw()">ÇEKİM TALEBİ OLUŞTUR</button>
        <button onclick="closeDrawer()" style="width:100%; background:none; border:none; color:white; margin-top:15px; opacity:0.4;">Kapat</button>
    </div>

    <nav>
        <div class="nav-item" onclick="showTab('v-tasks', this)">GÖREVLER</div>
        <div class="nav-item active" onclick="showTab('v-home', this)">ANA SAYFA</div>
        <div class="nav-item" onclick="showTab('v-wallet', this)">CÜZDAN</div>
    </nav>

<script>
    const tg = window.Telegram.WebApp;
    const firebaseConfig = { /* Buraya sizin config gelmeli */ };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const uid = tg.initDataUnsafe?.user?.id ? String(tg.initDataUnsafe.user.id) : "admin_test";

    let uData = { pi: 0, lvl: 1 }; // 'pi' değişkeni veritabanında aynı kalsın, biz arayüzde USDT gösteriyoruz
    let mInt = null, sessUsdt = 0;

    function init() {
        tg.expand();
        db.collection("users").doc(uid).onSnapshot(doc => {
            if(doc.exists) { 
                uData = doc.data(); 
                document.getElementById('total-bal').innerText = uData.pi.toFixed(2);
            } else { db.collection("users").doc(uid).set(uData); }
        });
    }

    function showTab(id, el) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
    }

    // MINING
    function startMining() {
        document.getElementById('v-mining').style.display = 'flex';
        mInt = setInterval(() => {
            let gain = 0.0001;
            sessUsdt += gain;
            document.getElementById('m-earned').innerText = sessUsdt.toFixed(4);
        }, 1000);
    }

    function stopMining() {
        clearInterval(mInt);
        db.collection("users").doc(uid).update({ pi: firebase.firestore.FieldValue.increment(sessUsdt) });
        document.getElementById('v-mining').style.display = 'none';
        tg.showAlert(`${sessUsdt.toFixed(4)} USDT toplandı!`);
        sessUsdt = 0;
    }

    // GÖREV SİSTEMİ
    let activeTask = null;
    function openTask(name, reward) {
        activeTask = { name, reward };
        document.getElementById('td-title').innerText = name;
        document.getElementById('td-reward').innerText = reward + " USDT";
        document.getElementById('task-drawer').classList.add('open');
    }

    function completeTask() {
        tg.showAlert("Görev kontrol ediliyor...");
        setTimeout(() => {
            db.collection("users").doc(uid).update({ pi: firebase.firestore.FieldValue.increment(activeTask.reward) });
            closeDrawer();
            tg.showAlert("Harika! Ödül hesabına eklendi.");
        }, 2000);
    }

    // ÇEKİM SİSTEMİ
    function openWithdraw(bank) {
        document.getElementById('wd-title').innerText = bank + " USDT Çekim";
        document.getElementById('withdraw-drawer').classList.add('open');
    }

    function confirmWithdraw() {
        const amount = parseFloat(document.getElementById('wd-amount').value);
        const addr = document.getElementById('trc20-addr').value;

        if(amount < 5) {
            tg.showAlert("Hata: Minimum çekim 5 USDT'dir.");
            return;
        }
        if(uData.pi < amount) {
            tg.showAlert("Yetersiz bakiye!");
            return;
        }
        if(addr.length < 10) {
            tg.showAlert("Geçersiz TRC20 adresi!");
            return;
        }

        tg.showAlert("Talep Alındı! 8392479231 ID'li admin tarafından onaylanacaktır.");
        closeDrawer();
    }

    function closeDrawer() {
        document.querySelectorAll('.drawer').forEach(d => d.classList.remove('open'));
    }

    window.onload = init;
</script>
</body>
</html>
