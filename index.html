<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pet Master - 9:16 Cloud</title>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, onSnapshot, query } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyApwj-8tB4qxqe8yJ9uP7XuKfEdT2lwYv4",
            authDomain: "fonix-b4de6.firebaseapp.com",
            projectId: "fonix-b4de6",
            storageBucket: "fonix-b4de6.firebasestorage.app",
            messagingSenderId: "20899545652",
            appId: "1:20899545652:web:f32ef599f0c8d3deaec061",
            measurementId: "G-WBYY85RNF5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- MASTER ADMIN KONTROL√ú ---
        const MASTER_ID = "8392479231"; 
        let currentUID = MASTER_ID; // √úretimde burasƒ± Telegram'dan gelir
        let userLocal = { balance: 0.0, refUsed: false };
        let sessionUSD = 0;
        let isMining = false;
        let timer;

        async function initApp() {
            const dRef = doc(db, "users", currentUID);
            const snap = await getDoc(dRef);

            if (snap.exists()) {
                userLocal = snap.data();
            } else {
                userLocal = {
                    balance: 0.0,
                    refUsed: false,
                    isAdmin: (currentUID === MASTER_ID),
                    username: "@user_" + currentUID.slice(-4)
                };
                await setDoc(dRef, userLocal);
            }
            updateScreenUI();
            if(userLocal.isAdmin) loadMasterPanel();
        }

        window.startWork = () => {
            isMining = true;
            changeTab('mining');
            timer = setInterval(() => {
                sessionUSD += 0.000015;
                document.getElementById('m-val').innerText = sessionUSD.toFixed(5);
            }, 1000);
        };

        window.stopWork = async () => {
            clearInterval(timer);
            userLocal.balance += sessionUSD;
            sessionUSD = 0;
            await updateDoc(doc(db, "users", currentUID), { balance: userLocal.balance });
            isMining = false;
            updateScreenUI();
            changeTab('home');
        };

        window.applyRef = async () => {
            if(userLocal.refUsed) return alert("Kod zaten kullanƒ±ldƒ±!");
            userLocal.balance += 0.05;
            userLocal.refUsed = true;
            await updateDoc(doc(db, "users", currentUID), { balance: userLocal.balance, refUsed: true });
            updateScreenUI();
            alert("$0.05 Eklendi!");
        };

        function loadMasterPanel() {
            onSnapshot(collection(db, "users"), (s) => {
                const l = document.getElementById('master-list');
                l.innerHTML = "";
                s.forEach(d => {
                    const u = d.data();
                    l.innerHTML += `<div class="adm-row">
                        <span>${u.username}</span>
                        <b style="color:#ffcc00">$${u.balance.toFixed(2)}</b>
                    </div>`;
                });
            });
        }

        function updateScreenUI() {
            document.getElementById('top-bal').innerText = userLocal.balance.toFixed(4);
            document.getElementById('wall-bal').innerText = userLocal.balance.toFixed(4);
        }

        window.changeTab = (t) => {
            if(isMining && t !== 'mining') return;
            document.querySelectorAll('.scr').forEach(s => s.classList.remove('active'));
            document.getElementById('scr-'+t).classList.add('active');
        };

        window.onload = initApp;
    </script>

    <style>
        :root { --p: #5c59d3; --y: #ffcc00; --bg: #000; }
        * { box-sizing: border-box; font-family: 'Arial Black', sans-serif; }
        body, html { margin: 0; padding: 0; background: var(--bg); height: 100vh; overflow: hidden; display: flex; justify-content: center; align-items: center; }

        /* 9:16 Aspect Ratio Container */
        #mobile-frame {
            aspect-ratio: 9 / 16;
            height: 95vh;
            background: linear-gradient(180deg, #6a67e6 0%, #4a47b1 100%);
            position: relative; border-radius: 40px; border: 8px solid #333;
            display: flex; flex-direction: column; color: #fff; overflow: hidden;
        }

        header { padding: 20px; display: flex; justify-content: space-between; align-items: center; }
        .bal-pill { background: rgba(0,0,0,0.4); padding: 8px 15px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.2); }
        
        .scr { flex: 1; display: none; flex-direction: column; align-items: center; padding: 20px; text-align: center; }
        .active { display: flex; }

        .card { background: rgba(0,0,0,0.3); width: 100%; padding: 15px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 10px; }
        .btn { background: var(--y); color: #000; border: none; width: 100%; padding: 15px; border-radius: 25px; font-weight: bold; cursor: pointer; }
        
        .adm-row { display: flex; justify-content: space-between; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 10px; margin-bottom: 5px; font-size: 12px; }

        .mining-img { width: 80%; aspect-ratio: 1; border-radius: 50%; border: 6px solid #fff; animation: rot 3s linear infinite; margin: 20px 0; }
        @keyframes rot { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        nav { height: 70px; background: #8184f7; display: flex; justify-content: space-around; align-items: center; }
        .nav-icon { font-size: 20px; cursor: pointer; opacity: 0.6; }
    </style>
</head>
<body>

<div id="mobile-frame">
    <header>
        <div class="bal-pill">üêæ <span id="top-bal">0.0000</span></div>
        <div onclick="stopWork()" id="stop-btn" style="cursor:pointer; font-weight:bold; color:var(--y)">[X]</div>
    </header>

    <div id="scr-home" class="scr active">
        <img src="yourfantastic.jpg" style="width:100%; border-radius:20px; margin-top:10px;">
        <h2 style="margin:20px 0;">FANTASTIC PET</h2>
        <div style="flex:1"></div>
        <button class="btn" onclick="startWork()">PLAY & EARN</button>
    </div>

    <div id="scr-friends" class="scr">
        <h3>FRIENDS</h3>
        <div class="card">
            <p>Sizi kim getirdi?</p>
            <input type="text" style="width:100%; padding:10px; border-radius:10px; margin-bottom:10px;">
            <button class="btn" onclick="applyRef()">ONAYLA</button>
        </div>
        <p>Kodun: <b>PET839247</b></p>
    </div>

    <div id="scr-admin" class="scr">
        <h3 style="color:#ff4757;">MASTER PANEL</h3>
        <div id="master-list" style="width:100%;"></div>
    </div>

    <div id="scr-wallet" class="scr">
        <h3>WALLET</h3>
        <div class="card">
            <h1 style="color:var(--y);">$<span id="wall-bal">0.0000</span></h1>
        </div>
        <button class="btn">PARA √áEK</button>
    </div>

    <div id="scr-mining" class="scr">
        <h2>KAZILIYOR...</h2>
        <h1 style="color:var(--y);">$<span id="m-val">0.00000</span></h1>
        <img src="pinix.jpg" class="mining-img">
    </div>

    <nav>
        <div class="nav-icon" onclick="changeTab('friends')">üë•</div>
        <div class="nav-icon" onclick="changeTab('home')">üêæ</div>
        <div class="nav-icon" onclick="changeTab('admin')">‚öôÔ∏è</div>
        <div class="nav-icon" onclick="changeTab('wallet')">üëõ</div>
    </nav>
</div>

</body>
</html>
