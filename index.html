<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Koalas: Simple Mining</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js?56"></script>
    <script type="text/javascript" src="https://cdn.tgads.space/assets/js/adexium-widget.min.js"></script>
    <script src='//libtl.com/sdk.js' data-zone='10432457' data-sdk='show_10432457'></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCfQGeQUVom6cX8aDyfXdGNly0L1Rlj87I",
            authDomain: "fonixapp.firebaseapp.com",
            projectId: "fonixapp",
            storageBucket: "fonixapp.firebasestorage.app",
            messagingSenderId: "980255542194",
            appId: "1:980255542194:web:883a3f7a8fc05fee6332ab"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const tg = window.Telegram.WebApp;
        tg.expand();

        const user = tg.initDataUnsafe?.user;
        const myID = user?.id ? user.id.toString() : "8392479231";
        
        let stats = { kls_bal: 0, usdt_bal: 0 };
        let miningTimer;
        let sKLS = 0, sUSDT = 0, timeLeft = 30;

        async function init() {
            new AdexiumWidget({ wid: 'd0ca8f05-2b16-4290-b24a-81d2e62a5db2', adFormat: 'push-like' }).autoMode();
            const userSnap = await getDoc(doc(db, "users", myID));
            if (userSnap.exists()) stats = userSnap.data();
            else await setDoc(doc(db, "users", myID), { kls_bal: 0, usdt_bal: 0 });
            updateUI();
        }

        window.startMiningProcess = () => {
            // Ekran deÄŸiÅŸtir
            document.getElementById('home-screen').style.display = 'none';
            document.getElementById('mining-screen').style.display = 'flex';
            document.getElementById('pet-img-mine').classList.add('pet-active');

            miningTimer = setInterval(() => {
                sKLS += 0.01;
                sUSDT += 0.00001;
                timeLeft--;

                document.getElementById('live-kls').innerText = sKLS.toFixed(3);
                document.getElementById('live-usdt').innerText = "$" + sUSDT.toFixed(6);
                document.getElementById('timer-text').innerText = timeLeft + "s";
                document.getElementById('progress-fill').style.width = (timeLeft / 30 * 100) + "%";

                if (timeLeft <= 0) {
                    clearInterval(miningTimer);
                    triggerClaim();
                }
            }, 1000);
        };

        async function triggerClaim() {
            // ReklamÄ± GÃ¶ster
            show_10432457().then(() => finalizeAwards()).catch(() => finalizeAwards());
        }

        async function finalizeAwards() {
            // Para YaÄŸmuru
            createRain();
            
            // VeritabanÄ± GÃ¼ncelle
            await updateDoc(doc(db, "users", myID), { 
                kls_bal: increment(sKLS), 
                usdt_bal: increment(sUSDT) 
            });

            setTimeout(() => location.reload(), 4000);
        }

        function createRain() {
            const layer = document.getElementById('rain-layer');
            layer.style.display = 'block';
            for(let i=0; i<50; i++){
                setTimeout(() => {
                    const d = document.createElement('div');
                    d.className = 'drop'; d.innerText = Math.random() > 0.5 ? 'ðŸª™' : 'ðŸ’µ';
                    d.style.left = Math.random() * 95 + 'vw';
                    layer.appendChild(d);
                    setTimeout(() => d.remove(), 2500);
                }, i*60);
            }
        }

        function updateUI() {
            document.getElementById('total-kls').innerText = stats.kls_bal.toFixed(2);
            document.getElementById('total-usdt').innerText = stats.usdt_bal.toFixed(4);
        }

        window.onload = init;
    </script>

    <style>
        :root { --purple: #5c3eb3; --yellow: #f7d348; --blue: #38b6ff; }
        body { margin: 0; background: var(--purple); color: #fff; font-family: 'Arial Rounded MT Bold', sans-serif; overflow: hidden; }
        
        .screen { width: 100vw; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; box-sizing: border-box; }
        
        /* Ãœst Bakiye Paneli */
        .header { position: fixed; top: 15px; width: 90%; display: flex; justify-content: space-between; z-index: 10; }
        .chip { background: rgba(0,0,0,0.3); padding: 8px 15px; border-radius: 20px; font-size: 14px; border: 1px solid rgba(255,255,255,0.1); }

        /* Pet GÃ¶rseli */
        .pet-box { width: 220px; height: 220px; background: var(--blue); border: 6px solid #fff; border-radius: 20px; display: flex; justify-content: center; align-items: center; margin-bottom: 30px; box-shadow: 0 10px 0 rgba(0,0,0,0.2); }
        .pet-img { width: 80%; }
        .pet-active { animation: bounce 0.8s infinite; }

        /* Buton */
        .btn-play { background: var(--yellow); color: var(--purple); border: none; padding: 20px 80px; border-radius: 25px; font-size: 28px; font-weight: 900; cursor: pointer; border-bottom: 6px solid #d4b12d; text-transform: uppercase; }
        
        /* Mining EkranÄ± Ã–zel */
        #mining-screen { display: none; background: #2c1d7a; }
        .counter-box { text-align: center; margin-bottom: 30px; }
        .val-kls { font-size: 45px; color: var(--yellow); display: block; }
        .val-usdt { font-size: 20px; color: #00ffaa; }
        
        /* Progress Bar */
        .timer-wrap { width: 100%; max-width: 300px; }
        .progress-bg { width: 100%; height: 12px; background: rgba(0,0,0,0.3); border-radius: 10px; overflow: hidden; margin-top: 10px; border: 2px solid #fff; }
        #progress-fill { width: 100%; height: 100%; background: var(--yellow); transition: 1s linear; }

        /* Animasyonlar */
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        #rain-layer { position: absolute; inset: 0; pointer-events: none; z-index: 100; display: none; }
        .drop { position: absolute; top: -50px; font-size: 30px; animation: fall 2s linear forwards; }
        @keyframes fall { to { transform: translateY(110vh) rotate(360deg); } }
    </style>
</head>
<body>

    <div class="header">
        <div class="chip">ðŸª™ <span id="total-kls">0.00</span></div>
        <div class="chip">ðŸ’µ $<span id="total-usdt">0.0000</span></div>
    </div>

    <div id="home-screen" class="screen">
        <div class="pet-box">
            <img src="koalasmining.jpg" class="pet-img">
        </div>
        <button class="btn-play" onclick="startMiningProcess()">PLAY</button>
        <p style="margin-top:20px; opacity:0.6;">Ready to mine?</p>
    </div>

    <div id="mining-screen" class="screen">
        <div class="counter-box">
            <small>MINING PROGRESS</small>
            <span id="live-kls" class="val-kls">0.000</span>
            <span id="live-usdt" class="val-usdt">$0.000000</span>
        </div>

        <div class="pet-box" style="transform: scale(0.8);">
            <img id="pet-img-mine" src="koalasmining.jpg" class="pet-img">
        </div>

        <div class="timer-wrap">
            <div style="display:flex; justify-content:space-between;">
                <span>Time Remaining:</span>
                <b id="timer-text">30s</b>
            </div>
            <div class="progress-bg"><div id="progress-fill"></div></div>
        </div>
    </div>

    <div id="rain-layer"></div>

</body>
</html>
