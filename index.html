<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FONIX GEP v507</title>
    <script src="https://telegram.org/js/telegram-web-app.js?56"></script>
    <script src="https://adexora.com/cdn/ads.js?id=1701"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&family=Syncopate:wght@700&display=swap" rel="stylesheet">
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCfQGeQUVom6cX8aDyfXdGNly0L1Rlj87I",
            authDomain: "fonixapp.firebaseapp.com",
            projectId: "fonixapp",
            storageBucket: "fonixapp.firebasestorage.app",
            messagingSenderId: "980255542194",
            appId: "1:980255542194:web:883a3f7a8fc05fee6332ab"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const tg = window.Telegram.WebApp;

        const user = tg.initDataUnsafe?.user;
        const myID = user?.id ? user.id.toString() : "8392479231"; 
        
        const CARD_TYPES = [
            { id: 'common', name: 'COM', color: '#888', chance: 70 },
            { id: 'epic', name: 'EPIC', color: '#a335ee', chance: 20 },
            { id: 'legend', name: 'LEGD', color: '#ff8000', chance: 7 },
            { id: 'secret', name: 'SCRT', color: '#ff00ff', chance: 2.5 },
            { id: 'og', name: 'OG', color: '#00ffcc', chance: 0.5 }
        ];

        let stats = { usdt: 0, ton: 0, adsToday: 0, inventory: [] };

        async function init() {
            const userRef = doc(db, "users", myID);
            const snap = await getDoc(userRef);
            if (snap.exists()) stats = snap.data();
            else {
                stats = { usdt: 0, ton: 0, adsToday: 0, inventory: [], lastAdDate: new Date().toDateString() };
                await setDoc(userRef, stats);
            }
            updateUI();
        }

        function updateUI() {
            document.getElementById('usdt-val').innerText = stats.usdt.toFixed(5);
            document.getElementById('ton-val').innerText = stats.ton.toFixed(6);
            document.getElementById('ad-count').innerText = stats.adsToday;
            
            const grid = document.getElementById('card-grid');
            grid.innerHTML = "";
            CARD_TYPES.forEach(type => {
                const hasCard = stats.inventory?.includes(type.id);
                grid.innerHTML += `
                    <div class="card-mini ${hasCard ? 'owned' : 'locked'}" style="--clr: ${type.color}">
                        <div class="tier-tag">${type.name}</div>
                        <div class="status-ico">${hasCard ? 'üíé' : 'üîí'}</div>
                    </div>
                `;
            });
        }

        window.openChest = () => {
            if(stats.adsToday >= 50) return tg.showAlert("G√ºnl√ºk limit doldu!");
            window.showAdexora().then(async () => {
                let uRew = Math.random() < 0.8 ? (Math.random()*(0.0001-0.000007)+0.000007) : (Math.random()*(0.001-0.0001)+0.0001);
                let tRew = Math.random()*(0.000007-0.000001)+0.000001;
                let wonCard = null;
                if(Math.random() < 0.001) {
                    const roll = Math.random() * 100;
                    let cur = 0;
                    for(let t of CARD_TYPES) { cur += t.chance; if(roll <= cur) { wonCard = t; break; } }
                }
                let newInv = stats.inventory || [];
                if(wonCard && !newInv.includes(wonCard.id)) newInv.push(wonCard.id);
                
                await updateDoc(doc(db, "users", myID), { usdt: increment(uRew), ton: increment(tRew), adsToday: increment(1), inventory: newInv });
                stats.usdt += uRew; stats.ton += tRew; stats.adsToday += 1; stats.inventory = newInv;
                updateUI();
                tg.showAlert(`Kazanƒ±lan: $${uRew.toFixed(5)} USDT & ${tRew.toFixed(6)} TON ${wonCard ? '\nNADƒ∞R KART BULDUN!' : ''}`);
            });
        };

        window.switchTab = (id, btn) => {
            document.querySelectorAll('.tab-page').forEach(p => p.classList.remove('on'));
            document.getElementById(id).classList.add('on');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('on-nav'));
            btn.classList.add('on-nav');
        };

        window.onload = init;
    </script>

    <style>
        :root { --main: #00ffcc; --bg: #0a0a0c; --glass: rgba(255,255,255,0.05); }
        body { margin: 0; background: var(--bg); color: #fff; font-family: 'Plus Jakarta Sans', sans-serif; user-select: none; }
        .app-shell { height: 100vh; display: flex; flex-direction: column; padding: 15px; }
        
        /* Bakiye Paneli */
        .top-stats { display: flex; gap: 10px; margin-bottom: 20px; }
        .stat-box { flex: 1; background: var(--glass); padding: 12px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.1); }
        .stat-box label { font-size: 8px; opacity: 0.5; font-weight: 800; display: block; margin-bottom: 4px; }
        .stat-box div { font-family: 'Syncopate'; font-size: 13px; color: var(--main); }

        .tab-page { display: none; flex: 1; }
        .on { display: block; animation: scaleUp 0.2s ease; }
        @keyframes scaleUp { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }

        /* Kartlar (K√º√ß√ºlt√ºlm√º≈ü) */
        #card-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .card-mini { 
            aspect-ratio: 1/1.3; border-radius: 12px; border: 1px solid #222; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: 0.3s; position: relative;
        }
        .locked { background: #111; opacity: 0.3; }
        .owned { background: #1a1a1a; border-color: var(--clr); box-shadow: 0 0 10px var(--clr); }
        .tier-tag { font-family: 'Syncopate'; font-size: 7px; color: var(--clr); }
        .status-ico { font-size: 16px; margin-top: 5px; }

        /* Sandƒ±k Butonu */
        .chest-container { 
            background: linear-gradient(135deg, #111, #000); border: 2px solid var(--main);
            border-radius: 24px; padding: 40px 20px; text-align: center; margin-top: 20px;
            box-shadow: 0 10px 30px rgba(0,255,204,0.1);
        }
        .chest-container:active { transform: translateY(4px); background: var(--main); color: #000; }

        .nav { position: fixed; bottom: 15px; left: 15px; right: 15px; background: rgba(0,0,0,0.9); height: 70px; border-radius: 20px; display: flex; justify-content: space-around; align-items: center; border: 1px solid #222; }
        .nav-btn { background: none; border: none; color: #fff; opacity: 0.3; font-size: 8px; font-family: 'Syncopate'; }
        .on-nav { opacity: 1; color: var(--main); }
    </style>
</head>
<body>

<div class="app-shell">
    <div class="top-stats">
        <div class="stat-box">
            <label>USDT ASSETS</label>
            <div id="usdt-val">0.00000</div>
        </div>
        <div class="stat-box">
            <label>TON NETWORK</label>
            <div id="ton-val" style="color:#0088cc">0.000000</div>
        </div>
    </div>

    <div id="home" class="tab-page on">
        <div class="chest-container" onclick="openChest()">
            <div style="font-size: 44px;">üì¶</div>
            <div style="font-family: 'Syncopate'; font-size: 12px; margin-top: 10px;">Gƒ∞FT CHEST OPEN</div>
            <div style="font-size: 9px; opacity: 0.5; margin-top: 5px;">HAK: <span id="ad-count">0</span>/50</div>
        </div>
    </div>

    <div id="cards" class="tab-page">
        <h4 style="font-family: 'Syncopate'; font-size: 10px; margin-bottom: 15px; opacity: 0.6;">COLLECTION</h4>
        <div id="card-grid"></div>
    </div>

    <div id="wallet" class="tab-page">
        <div class="stat-box" style="padding:20px; margin-top:10px;">
            <label>WITHDRAW</label>
            <input type="text" placeholder="TON Wallet Address" style="width:100%; background:none; border:none; color:#fff; font-size:14px; margin-top:10px; outline:none;">
            <button onclick="tg.showAlert('Min 10 USDT')" style="width:100%; padding:15px; background:var(--main); border:none; border-radius:12px; margin-top:20px; font-family:'Syncopate'; font-size:10px;">PROCESS</button>
        </div>
    </div>

    <div class="nav">
        <button class="nav-btn on-nav" onclick="switchTab('home', this)">üéÅ<br>OPEN</button>
        <button class="nav-btn" onclick="switchTab('cards', this)">üÉè<br>CARDS</button>
        <button class="nav-btn" onclick="switchTab('wallet', this)">üí∞<br>CASH</button>
    </div>
</div>

</body>
</html>
