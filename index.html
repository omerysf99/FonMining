<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PINIX FAN MINER</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;700&family=Montserrat:wght@900&display=swap" rel="stylesheet">
    
    <style>
        :root { --bg: #0a0a0a; --accent: #8eff31; --yellow: #fbc02d; }
        * { margin:0; padding:0; box-sizing:border-box; font-family: 'Fredoka', sans-serif; }
        
        body { 
            background: var(--bg); color: white; overflow: hidden; height: 100vh;
            background-image: radial-gradient(circle at 50% 50%, #1a1a1a 0%, #000 100%);
        }

        #app { width:100%; max-width:450px; height:100vh; margin:auto; position:relative; display:flex; flex-direction:column; padding: 20px; }

        /* Üst Bilgi Paneli */
        .top-info { text-align: center; margin-top: 20px; }
        .level-text { font-size: 2rem; font-weight: 700; color: white; letter-spacing: 2px; }
        .usd-val { color: var(--accent); font-family: 'Montserrat'; font-size: 1.2rem; margin-top: 5px; }

        /* MERKEZİ FAN ALANI */
        .fan-container { flex: 1; display: flex; align-items: center; justify-content: center; position: relative; }
        .pinix-fan { 
            width: 280px; height: 280px; border-radius: 50%;
            border: 8px solid rgba(142, 255, 49, 0.1);
            box-shadow: 0 0 50px rgba(142, 255, 49, 0.2);
            object-fit: cover;
            transition: 0.3s;
        }
        
        /* Fan Dönüş Animasyonu */
        .spinning { animation: rotateFan 2s linear infinite; }
        @keyframes rotateFan { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* Alt İstatistikler (3'lü Panel) */
        .stats-grid { 
            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; 
            margin-bottom: 30px; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 20px;
        }
        .stat-item { text-align: center; }
        .stat-label { font-size: 0.6rem; opacity: 0.6; text-transform: uppercase; margin-top: 5px; }
        .stat-val { font-size: 0.9rem; font-weight: 700; color: var(--accent); }

        /* Kontrol Butonları */
        .btn-play { 
            background: var(--accent); color: black; border: none; border-radius: 50px;
            padding: 18px; font-size: 1.4rem; font-weight: 700; cursor: pointer;
            box-shadow: 0 10px 20px rgba(142, 255, 49, 0.3); transition: 0.2s;
        }
        .btn-play:active { transform: scale(0.95); }
        .btn-stop { background: #ff3131; color: white; box-shadow: 0 10px 20px rgba(255, 49, 49, 0.3); }

        /* Progress Bar */
        .progress-container { width: 100%; height: 6px; background: #222; border-radius: 10px; margin: 20px 0; overflow: hidden; }
        .progress-bar { width: 0%; height: 100%; background: var(--accent); transition: 0.5s; }
    </style>
</head>
<body>

<div id="app">
    <div class="top-info">
        <div class="level-text">LEVEL <span id="lvl-num">1</span></div>
        <div class="usd-val">$ <span id="usd-amt">0.0037</span></div>
    </div>

    <div class="fan-container">
        <img src="pinix.jpg" id="fan-img" class="pinix-fan" onerror="this.src='https://via.placeholder.com/280?text=pinix.jpg+bulunamadi'">
    </div>

    <div class="progress-container">
        <div id="p-bar" class="progress-bar"></div>
    </div>

    <div class="stats-grid">
        <div class="stat-item">
            <div id="stat-time" class="stat-val">00:00</div>
            <div class="stat-label">DAKİKA</div>
        </div>
        <div class="stat-item">
            <div id="stat-pi" class="stat-val">0.00</div>
            <div class="stat-label">TOPLAM PI</div>
        </div>
        <div class="stat-item">
            <div id="stat-speed" class="stat-val">0.0005/s</div>
            <div class="stat-label">HIZ</div>
        </div>
    </div>

    <button id="action-btn" class="btn-play" onclick="toggleMining()">START MINING</button>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyApwj-8tB4qxqe8yJ9uP7XuKfEdT2lwYv4",
        authDomain: "fonix-b4de6.firebaseapp.com",
        projectId: "fonix-b4de6",
        storageBucket: "fonix-b4de6.firebasestorage.app",
        messagingSenderId: "20899545652",
        appId: "1:20899545652:web:f32ef599f0c8d3deaec061"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const tg = window.Telegram.WebApp;
    
    let isMining = false;
    let seconds = 0;
    let sessionPi = 0;
    let timerInt = null;
    let uid = tg.initDataUnsafe?.user?.id ? String(tg.initDataUnsafe.user.id) : "dev_user";

    function toggleMining() {
        const btn = document.getElementById('action-btn');
        const fan = document.getElementById('fan-img');
        const pBar = document.getElementById('p-bar');

        if (!isMining) {
            // BAŞLAT
            isMining = true;
            btn.innerText = "STOP MINING";
            btn.classList.add('btn-stop');
            fan.classList.add('spinning');
            pBar.style.width = "100%";
            
            timerInt = setInterval(() => {
                seconds++;
                sessionPi += 0.0005;
                updateStats();
            }, 1000);
            
            tg.HapticFeedback.impactOccurred('medium');
        } else {
            // DURDUR
            stopAndSave();
        }
    }

    function stopAndSave() {
        clearInterval(timerInt);
        isMining = false;
        
        const btn = document.getElementById('action-btn');
        const fan = document.getElementById('fan-img');
        const pBar = document.getElementById('p-bar');

        btn.innerText = "START MINING";
        btn.classList.remove('btn-stop');
        fan.classList.remove('spinning');
        pBar.style.width = "0%";

        // Firebase'e kaydet
        db.collection("users").doc(uid).update({
            pi: firebase.firestore.FieldValue.increment(sessionPi)
        }).then(() => {
            tg.showAlert(`Mining Tamamlandı!\nKazanç: ${sessionPi.toFixed(4)} PI`);
            sessionPi = 0;
            seconds = 0;
            updateStats();
        });
    }

    function updateStats() {
        const mins = Math.floor(seconds / 60);
        const secs = seconds % 60;
        document.getElementById('stat-time').innerText = 
            `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        document.getElementById('stat-pi').innerText = sessionPi.toFixed(4);
        
        // Dolar değerini güncelle (Örnek çarpan)
        document.getElementById('usd-amt').innerText = (0.0037 + (sessionPi * 0.1)).toFixed(4);
    }

    window.onload = () => {
        tg.expand();
        // İlk veriyi çek
        db.collection("users").doc(uid).get().then(doc => {
            if(!doc.exists) db.collection("users").doc(uid).set({pi:0, lvl:1});
        });
    };
</script>
</body>
</html>
