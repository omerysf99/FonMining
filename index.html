<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PI NEBULA - V61</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;700&family=Montserrat:wght@900&display=swap" rel="stylesheet">
    
    <style>
        :root { 
            --bg-main: #4c3ba5; --bg-dark: #0f172a; --bg-card: #1e293b; 
            --accent: #8eff31; --yellow: #fbc02d; --text-muted: #94a3b8;
        }

        * { margin:0; padding:0; box-sizing:border-box; font-family: 'Fredoka', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg-main); color: white; overflow: hidden; height: 100vh; }

        /* --- SAYFA YAPISI --- */
        .view { display: none; height: 100vh; flex-direction: column; padding: 25px; overflow-y: auto; padding-bottom: 110px; }
        .view.active { display: flex; }

        /* --- ANA EKRAN (KLASƒ∞K STƒ∞L) --- */
        #v-home { align-items: center; justify-content: center; text-align: center; background-image: radial-gradient(circle at 50% 30%, #5e48c2 0%, #2c1a74 100%); }
        .hero-img { width: 220px; filter: drop-shadow(0 15px 30px rgba(0,0,0,0.5)); margin-bottom: 20px; }
        .bal-display { font-family: 'Montserrat'; font-size: 2.8rem; color: var(--yellow); text-shadow: 0 0 15px rgba(251, 192, 45, 0.4); margin-bottom: 25px; }

        /* --- G√ñREVLER (TEMƒ∞Z Lƒ∞STE) --- */
        .task-card { background: rgba(255,255,255,0.08); border-radius: 18px; padding: 18px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; border: 1px solid rgba(255,255,255,0.05); }
        .task-info h4 { font-size: 1rem; color: var(--yellow); }
        .task-info p { font-size: 0.75rem; opacity: 0.6; }
        .btn-claim { background: var(--accent); color: black; padding: 8px 15px; border-radius: 10px; font-weight: 700; border: none; font-size: 0.8rem; }

        /* --- WITHDRAW (BORSA SE√áƒ∞Mƒ∞) --- */
        .withdraw-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .bank-card { background: var(--bg-card); border-radius: 20px; padding: 20px; text-align: center; border: 1px solid rgba(255,255,255,0.1); transition: 0.2s; }
        .bank-card:active { transform: scale(0.95); background: #2d3748; }
        .bank-card img { height: 30px; margin-bottom: 10px; filter: grayscale(1) brightness(2); }
        .bank-card span { display: block; font-size: 0.9rem; font-weight: 700; }
        .bank-card small { font-size: 0.6rem; color: var(--accent); }

        /* --- MINING OVERLAY --- */
        #v-mining { position: fixed; top:0; left:0; width:100%; height:100%; background: #000; z-index: 2000; display:none; flex-direction:column; align-items:center; justify-content:space-around; padding:40px; }
        .fan-spin { width: 250px; height: 250px; border-radius: 50%; border: 6px solid var(--accent); animation: rotate 1s linear infinite; object-fit: cover; }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* --- ALT NAV --- */
        nav { position: fixed; bottom: 0; width: 100%; height: 90px; background: rgba(44, 26, 116, 0.95); backdrop-filter: blur(15px); display: flex; justify-content: space-around; align-items: center; border-top: 1px solid rgba(255,255,255,0.1); border-radius: 25px 25px 0 0; z-index: 1000; }
        .nav-item { text-align: center; opacity: 0.4; font-size: 0.7rem; color: white; }
        .nav-item.active { opacity: 1; color: var(--yellow); }
        .nav-item i { font-size: 1.6rem; display: block; margin-bottom: 4px; }

        /* --- BUTONLAR --- */
        .btn-main { width: 85%; padding: 20px; border: none; border-radius: 50px; font-size: 1.4rem; font-weight: 900; cursor: pointer; transition: 0.2s; box-shadow: 0 8px 0 rgba(0,0,0,0.3); }
        .btn-play { background: var(--yellow); color: #2c1a74; }
        .btn-stop { background: #ff3131; color: white; }
        .btn-main:active { transform: translateY(4px); box-shadow: none; }

        header { position: absolute; top: 15px; width: 100%; padding: 0 20px; display: flex; justify-content: space-between; z-index: 100; }
        .badge { background: rgba(0,0,0,0.4); padding: 5px 12px; border-radius: 12px; font-size: 0.75rem; border: 1px solid rgba(255,255,255,0.1); }
    </style>
</head>
<body>

<div id="app">
    <header id="ui-header">
        <div class="badge">LVL <span id="u-lvl">1</span></div>
        <div class="badge" style="color:var(--accent)">ADMIN: 8392479231</div>
    </header>

    <div id="v-home" class="view active">
        <img src="yourfantastic.jpg" class="hero-img" onerror="this.src='https://via.placeholder.com/220'">
        <h1 style="line-height: 0.9; margin-bottom: 10px;">YOUR<br>FANTASTIC PET</h1>
        <div class="bal-display" id="total-bal">0.00</div>
        <button class="btn-main btn-play" onclick="startMining()">PLAY / START</button>
    </div>

    <div id="v-tasks" class="view">
        <h2 style="margin-bottom:20px; text-align:center;">TASKS</h2>
        <div class="task-card">
            <div class="task-info"><h4>√ñrnek G√∂rev #1</h4><p>√ñd√ºl: 5.00 PI</p></div>
            <button class="btn-claim" onclick="alert('G√∂rev Tamamlandƒ±!')">YAP</button>
        </div>
        <div class="task-card">
            <div class="task-info"><h4>√ñrnek G√∂rev #2</h4><p>√ñd√ºl: 10.00 PI</p></div>
            <button class="btn-claim" onclick="alert('G√∂rev Tamamlandƒ±!')">YAP</button>
        </div>
        <div class="task-card">
            <div class="task-info"><h4>√ñrnek G√∂rev #3</h4><p>√ñd√ºl: 2.50 PI</p></div>
            <button class="btn-claim" onclick="alert('G√∂rev Tamamlandƒ±!')">YAP</button>
        </div>
        <div class="task-card">
            <div class="task-info"><h4>√ñrnek G√∂rev #4</h4><p>√ñd√ºl: 15.00 PI</p></div>
            <button class="btn-claim" onclick="alert('G√∂rev Tamamlandƒ±!')">YAP</button>
        </div>
    </div>

    <div id="v-wallet" class="view">
        <h2 style="margin-bottom:10px; text-align:center;">WITHDRAW</h2>
        <p style="text-align:center; font-size:0.7rem; opacity:0.5; margin-bottom:20px;">Bakiye √áekmek ƒ∞√ßin Borsa Se√ßin</p>
        
        <div class="withdraw-grid">
            <div class="bank-card" onclick="openW('BINANCE')">
                <img src="https://cryptologos.cc/logos/binance-coin-bnb-logo.png">
                <span>BINANCE</span>
                <small>Min: 500 PI</small>
            </div>
            <div class="bank-card" onclick="openW('OKX')">
                <img src="https://cryptologos.cc/logos/okb-okb-logo.png">
                <span>OKX</span>
                <small>Min: 500 PI</small>
            </div>
            <div class="bank-card" onclick="openW('BYBIT')">
                <img src="https://cryptologos.cc/logos/bybit-bit-logo.png">
                <span>BYBIT</span>
                <small>Min: 500 PI</small>
            </div>
            <div class="bank-card" onclick="openW('GATE.IO')">
                <img src="https://cryptologos.cc/logos/gatechain-token-gt-logo.png">
                <span>GATE.IO</span>
                <small>Min: 500 PI</small>
            </div>
        </div>
    </div>

    <div id="v-mining">
        <h2 style="color:var(--accent); letter-spacing:4px;">MINING ACTIVE</h2>
        <img src="pinix.jpg" class="fan-spin" onerror="this.src='https://via.placeholder.com/250'">
        
        <div style="text-align:center; width:100%;">
            <div style="font-size:0.8rem; opacity:0.5;">SESSION EARNINGS</div>
            <div id="m-earned" style="font-size:2.5rem; color:var(--accent); font-family:'Montserrat'">0.0000</div>
            <div id="m-timer" style="font-size:0.7rem; margin-top:5px;">D√∂ng√º: 0/30s</div>
        </div>

        <button class="btn-main btn-stop" onclick="stopMining()">STOP & COLLECT</button>
    </div>

    <nav>
        <div class="nav-item" onclick="showTab('v-tasks', this)"><i>üéÅ</i>Tasks</div>
        <div class="nav-item active" onclick="showTab('v-home', this)"><i>üêæ</i>Home</div>
        <div class="nav-item" onclick="showTab('v-wallet', this)"><i>üí≥</i>Wallet</div>
    </nav>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyApwj-8tB4qxqe8yJ9uP7XuKfEdT2lwYv4",
        authDomain: "fonix-b4de6.firebaseapp.com",
        projectId: "fonix-b4de6",
        storageBucket: "fonix-b4de6.firebasestorage.app",
        messagingSenderId: "20899545652",
        appId: "1:20899545652:web:f32ef599f0c8d3deaec061"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const tg = window.Telegram.WebApp;
    const adminID = "8392479231";

    let uid = tg.initDataUnsafe?.user?.id ? String(tg.initDataUnsafe.user.id) : "dev_user";
    let uData = { pi: 0, lvl: 1 };
    
    let mInt = null;
    let sec = 0;
    let sessPi = 0;

    function init() {
        tg.expand();
        db.collection("users").doc(uid).onSnapshot(doc => {
            if(doc.exists) { 
                uData = doc.data(); 
                document.getElementById('total-bal').innerText = uData.pi.toFixed(2);
                document.getElementById('u-lvl').innerText = uData.lvl || 1;
            } else { 
                db.collection("users").doc(uid).set(uData); 
            }
        });
    }

    function showTab(tabId, el) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        if(el) {
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
        }
    }

    function startMining() {
        document.getElementById('v-mining').style.display = 'flex';
        sec = 0; sessPi = 0;
        document.getElementById('m-earned').innerText = "0.0000";

        mInt = setInterval(() => {
            sec++;
            let cycle = sec % 30;
            document.getElementById('m-timer').innerText = `D√∂ng√º: ${cycle}/30s`;

            if(sec > 0 && sec % 30 === 0) {
                let gain = Math.random() * (0.001 - 0.0001) + 0.0001;
                sessPi += gain;
                document.getElementById('m-earned').innerText = sessPi.toFixed(4);
                tg.HapticFeedback.notificationOccurred('success');
            }
        }, 1000);
    }

    function stopMining() {
        clearInterval(mInt);
        db.collection("users").doc(uid).update({
            pi: firebase.firestore.FieldValue.increment(sessPi)
        }).then(() => {
            document.getElementById('v-mining').style.display = 'none';
            tg.showAlert(`Kazanƒ±lan: ${sessPi.toFixed(4)} PI Bakiyenize Eklendi!`);
            sec = 0; sessPi = 0;
        });
    }

    function openW(exchange) {
        tg.showPopup({
            title: exchange + " √áekim",
            message: "Min 500 PI √ßekebilirsiniz. C√ºzdan ID'nizi girmeniz gerekecektir.",
            buttons: [{text: "Anladƒ±m", type: "ok"}]
        });
    }

    window.onload = init;
</script>
</body>
</html>
