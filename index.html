<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Koalas: Pro Infinite Mining</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js?56"></script>
    <script type="text/javascript" src="https://cdn.tgads.space/assets/js/adexium-widget.min.js"></script>
    <script src='//libtl.com/sdk.js' data-zone='10432457' data-sdk='show_10432457'></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, increment, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCfQGeQUVom6cX8aDyfXdGNly0L1Rlj87I",
            authDomain: "fonixapp.firebaseapp.com",
            projectId: "fonixapp",
            storageBucket: "fonixapp.firebasestorage.app",
            messagingSenderId: "980255542194",
            appId: "1:980255542194:web:883a3f7a8fc05fee6332ab"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const tg = window.Telegram.WebApp;
        tg.expand();

        const user = tg.initDataUnsafe?.user;
        const myID = user?.id ? user.id.toString() : "8392479231";
        
        let stats = { kls_bal: 0, usdt_bal: 0, hasUsedCode: false };
        let isMining = false, miningInterval, adTimer = 0;
        let sKLS = 0, sUSDT = 0;

        async function init() {
            const userSnap = await getDoc(doc(db, "users", myID));
            if (userSnap.exists()) stats = userSnap.data();
            updateUI();
        }

        window.toggleMining = () => {
            const btn = document.getElementById('mine-btn');
            if (!isMining) {
                isMining = true;
                btn.innerText = "MINING ACTIVE...";
                btn.style.background = "#ff4757";
                document.getElementById('fan-img').classList.add('fan-spin');
                
                miningInterval = setInterval(() => {
                    sKLS += 0.01;
                    sUSDT += 0.00001;
                    adTimer++;

                    document.getElementById('live-kls').innerText = sKLS.toFixed(3);
                    document.getElementById('live-usdt').innerText = "$" + sUSDT.toFixed(6);
                    document.getElementById('ad-progress').style.width = (adTimer / 30 * 100) + "%";

                    // 30 Saniyede Bir Reklam
                    if (adTimer >= 30) {
                        autoClaim();
                    }
                }, 1000);
            }
        };

        async function autoClaim() {
            clearInterval(miningInterval);
            document.getElementById('fan-img').classList.remove('fan-spin');
            
            // Reklamƒ± G√∂ster
            show_10432457().then(() => finalizeAdCycle()).catch(() => finalizeAdCycle());
        }

        async function finalizeAdCycle() {
            // Veritabanƒ± G√ºncelle
            await updateDoc(doc(db, "users", myID), { 
                kls_bal: increment(sKLS), 
                usdt_bal: increment(sUSDT) 
            });

            // Animasyon ve Reset
            createRain();
            sKLS = 0; sUSDT = 0; adTimer = 0;
            
            // 3 saniye sonra kazƒ±ma devam et
            setTimeout(() => {
                document.getElementById('rain-layer').style.display = 'none';
                isMining = false;
                toggleMining();
            }, 3000);
        }

        function createRain() {
            const layer = document.getElementById('rain-layer');
            layer.style.display = 'block';
            for(let i=0; i<30; i++) {
                const d = document.createElement('div');
                d.className = 'drop'; d.innerText = Math.random() > 0.5 ? 'ü™ô' : 'üíµ';
                d.style.left = Math.random() * 95 + 'vw';
                layer.appendChild(d);
                setTimeout(() => d.remove(), 2000);
            }
        }

        function updateUI() {
            document.getElementById('total-kls').innerText = stats.kls_bal.toFixed(2);
            document.getElementById('total-usdt').innerText = stats.usdt_bal.toFixed(4);
        }

        window.showTab = (name) => {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById('tab-' + name).classList.add('active');
        };

        window.onload = init;
    </script>

    <style>
        :root { --p: #5c3eb3; --y: #f7d348; --b: #38b6ff; --dark: #120a3d; }
        body { margin: 0; background: var(--dark); color: #fff; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        
        .header { height: 60px; display: flex; justify-content: space-around; align-items: center; background: rgba(0,0,0,0.4); border-bottom: 2px solid var(--p); }
        .tab-content { display: none; flex-direction: column; align-items: center; padding: 20px; height: calc(100vh - 130px); overflow-y: auto; }
        .active { display: flex; }

        /* Mining Ekranƒ± Geli≈ümi≈ü */
        .fan-area { width: 260px; height: 260px; position: relative; display: flex; justify-content: center; align-items: center; margin: 20px 0; }
        .fan-glow { position: absolute; width: 100%; height: 100%; background: radial-gradient(circle, var(--b) 0%, transparent 70%); opacity: 0.3; filter: blur(20px); }
        
        /* Arka planƒ± kaldƒ±rƒ±lmƒ±≈ü ve yuvarlak fan */
        .fan-frame { width: 200px; height: 200px; border-radius: 50%; border: 8px solid #fff; overflow: hidden; z-index: 2; box-shadow: 0 0 20px var(--b); }
        .fan-img { width: 100%; height: 100%; object-fit: cover; }
        .fan-spin { animation: spin 2s linear infinite; }

        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        .live-stats { text-align: center; z-index: 5; background: rgba(0,0,0,0.5); padding: 10px 30px; border-radius: 50px; border: 1px solid var(--p); }
        #live-kls { font-size: 40px; color: var(--y); font-weight: 900; display: block; }
        #live-usdt { color: #00ffaa; font-weight: bold; }

        /* Reklam Barƒ± */
        .ad-bar-wrap { width: 80%; height: 6px; background: #222; border-radius: 10px; margin: 15px 0; overflow: hidden; }
        #ad-progress { height: 100%; width: 0%; background: var(--y); transition: 1s linear; }

        .btn-mine { width: 85%; padding: 20px; border-radius: 20px; border: none; background: var(--y); color: var(--dark); font-size: 20px; font-weight: 900; cursor: pointer; border-bottom: 5px solid #b89610; }

        /* Navigasyon */
        .nav { height: 70px; display: flex; justify-content: space-around; align-items: center; background: #000; position: fixed; bottom: 0; width: 100%; }
        .nav-btn { background: none; border: none; color: #fff; font-size: 11px; opacity: 0.6; }

        #rain-layer { position: absolute; inset: 0; pointer-events: none; display: none; z-index: 100; }
        .drop { position: absolute; top: -50px; font-size: 30px; animation: fall 2s linear forwards; }
        @keyframes fall { to { transform: translateY(110vh) rotate(360deg); } }
    </style>
</head>
<body>

    <div class="header">
        <div>ü™ô <span id="total-kls">0.00</span></div>
        <div>üíµ $<span id="total-usdt">0.0000</span></div>
    </div>

    <div id="tab-mining" class="tab-content active">
        <div class="live-stats">
            <span id="live-kls">0.000</span>
            <span id="live-usdt">$0.000000</span>
        </div>

        <div class="fan-area">
            <div class="fan-glow"></div>
            <div class="fan-frame">
                <img id="fan-img" src="koalasmining.jpg" class="fan-img">
            </div>
        </div>

        <div style="font-size: 12px; opacity: 0.8;">NEXT REWARD CYCLE</div>
        <div class="ad-bar-wrap">
            <div id="ad-progress"></div>
        </div>

        <button id="mine-btn" class="btn-mine" onclick="toggleMining()">START MINING</button>
        <p style="font-size: 10px; margin-top: 10px; opacity: 0.5;">Auto-claim every 30 seconds</p>
    </div>

    <div id="tab-friends" class="tab-content">
        <h2>Friends Panel</h2>
        </div>

    <div id="rain-layer"></div>

    <nav class="nav">
        <button class="nav-btn" onclick="showTab('mining')">‚õèÔ∏è<br>Mining</button>
        <button class="nav-btn" onclick="showTab('friends')">üë•<br>Friends</button>
        <button class="nav-btn" onclick="showTab('wallet')">üí∞<br>Wallet</button>
    </nav>

</body>
</html>
