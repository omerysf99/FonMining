<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Koalas: Fantastic Pet</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js?56"></script>
    <script type="text/javascript" src="https://cdn.tgads.space/assets/js/adexium-widget.min.js"></script>
    <script src='//libtl.com/sdk.js' data-zone='10432457' data-sdk='show_10432457'></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, increment, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCfQGeQUVom6cX8aDyfXdGNly0L1Rlj87I",
            authDomain: "fonixapp.firebaseapp.com",
            projectId: "fonixapp",
            storageBucket: "fonixapp.firebasestorage.app",
            messagingSenderId: "980255542194",
            appId: "1:980255542194:web:883a3f7a8fc05fee6332ab"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const tg = window.Telegram.WebApp;
        tg.expand();

        const user = tg.initDataUnsafe?.user;
        const myID = user?.id ? user.id.toString() : "8392479231";
        
        let stats = { kls_bal: 0, usdt_bal: 0, energy: 100 };

        async function init() {
            new AdexiumWidget({ wid: 'd0ca8f05-2b16-4290-b24a-81d2e62a5db2', adFormat: 'push-like' }).autoMode();
            const userSnap = await getDoc(doc(db, "users", myID));
            if (userSnap.exists()) stats = userSnap.data();
            else await setDoc(doc(db, "users", myID), stats);
            updateUI();
        }

        let mInt, sKLS = 0, sUSDT = 0;

        window.toggleMining = () => {
            const btn = document.getElementById('main-btn');
            if (btn.innerText.includes("PLAY")) {
                if (stats.energy < 1) return tg.showAlert("Energy Empty!");
                startM();
            } else {
                show_10432457().then(() => stopM()).catch(() => stopM());
            }
        };

        function startM() {
            document.getElementById('main-btn').innerText = "CLAIM REWARDS";
            document.getElementById('pet-box').classList.add('mining-glow');
            document.getElementById('pet-img').classList.add('pet-jump');
            
            mInt = setInterval(() => {
                sKLS += 0.01; sUSDT += 0.00001;
                stats.energy -= 0.15;
                document.getElementById('live-kls').innerText = sKLS.toFixed(3);
                document.getElementById('live-usdt').innerText = sUSDT.toFixed(5);
                document.getElementById('energy-bar').style.width = stats.energy + "%";
                if (stats.energy <= 0) stopM();
            }, 1000);
        }

        async function stopM() {
            clearInterval(mInt);
            createRain();
            await updateDoc(doc(db, "users", myID), { 
                kls_bal: increment(sKLS), usdt_bal: increment(sUSDT), energy: stats.energy 
            });
            setTimeout(() => location.reload(), 4000);
        }

        function createRain() {
            const layer = document.getElementById('rain-layer');
            layer.style.display = 'block';
            for(let i=0; i<50; i++){
                setTimeout(() => {
                    const d = document.createElement('div');
                    d.className = 'drop'; d.innerText = Math.random() > 0.5 ? 'ðŸª™' : 'ðŸ’µ';
                    d.style.left = Math.random() * 90 + 'vw';
                    d.style.animationDuration = (Math.random()*2+1)+'s';
                    layer.appendChild(d);
                    setTimeout(() => d.remove(), 2500);
                }, i*60);
            }
        }

        function updateUI() {
            document.getElementById('total-kls').innerText = stats.kls_bal.toFixed(2);
            document.getElementById('total-usdt').innerText = stats.usdt_bal.toFixed(4);
        }

        window.onload = init;
    </script>

    <style>
        :root { --blue: #38b6ff; --purple: #4a34b2; --yellow: #f7d348; --dark: #2c1d7a; }
        body { margin: 0; background: var(--purple); color: #fff; font-family: 'Arial Rounded MT Bold', sans-serif; overflow: hidden; }
        #app { width: 100%; height: 100vh; display: flex; flex-direction: column; align-items: center; padding: 15px; box-sizing: border-box; }
        
        /* Fantastic Pet Header */
        .top-row { width: 100%; display: flex; justify-content: space-between; margin-bottom: 20px; }
        .stat-badge { background: rgba(0,0,0,0.4); padding: 8px 15px; border-radius: 25px; border: 2px solid rgba(255,255,255,0.2); text-align: center; min-width: 80px; }
        .stat-badge small { font-size: 9px; display: block; color: var(--yellow); }

        /* The Pet Box (Oyunun kalbi) */
        .pet-container { width: 280px; height: 280px; background: var(--blue); border: 8px solid #fff; border-radius: 20px; box-shadow: 0 10px 0 rgba(0,0,0,0.2); position: relative; display: flex; flex-direction: column; justify-content: center; align-items: center; overflow: hidden; }
        .pet-img { width: 180px; z-index: 2; transition: 0.3s; }
        .mining-glow { animation: bgPulse 2s infinite; }
        
        /* Mining Info Panels */
        .mining-info { width: 100%; display: flex; justify-content: space-between; margin: 20px 0; gap: 10px; }
        .info-card { flex: 1; background: var(--dark); border-radius: 15px; padding: 10px; text-align: center; border: 2px solid rgba(255,255,255,0.1); }
        .info-card h3 { margin: 5px 0; font-size: 20px; }

        /* Progress Bar */
        .energy-wrap { width: 100%; margin-bottom: 20px; }
        .bar-bg { width: 100%; height: 12px; background: #1a1a1a; border-radius: 10px; overflow: hidden; border: 2px solid #fff; }
        #energy-bar { width: 100%; height: 100%; background: linear-gradient(90deg, #ff4757, var(--yellow)); }

        /* Fantastic Button */
        .btn-play { width: 100%; background: var(--yellow); color: var(--purple); border: none; padding: 22px; border-radius: 25px; font-size: 24px; font-weight: 900; cursor: pointer; border-bottom: 8px solid #c9a61d; transition: 0.1s; text-transform: uppercase; }
        .btn-play:active { transform: translateY(4px); border-bottom: 4px solid #c9a61d; }

        /* Animations */
        @keyframes bgPulse { 0%, 100% { background: var(--blue); } 50% { background: #60c5ff; box-shadow: 0 0 40px var(--blue); } }
        @keyframes petJump { 0%, 100% { transform: translateY(0) scale(1); } 50% { transform: translateY(-15px) scale(1.05); } }
        .pet-jump { animation: petJump 0.8s infinite ease-in-out; }
        
        #rain-layer { position: absolute; inset: 0; pointer-events: none; z-index: 100; display: none; }
        .drop { position: absolute; top: -50px; font-size: 30px; animation: fall linear forwards; }
        @keyframes fall { to { transform: translateY(110vh) rotate(360deg); } }
    </style>
</head>
<body>

<div id="app">
    <div id="rain-layer"></div>

    <div class="top-row">
        <div class="stat-badge"><small>KOALAS</small><b id="total-kls">0.00</b></div>
        <div class="stat-badge"><small>USDT</small><b id="total-usdt">0.0000</b></div>
    </div>

    <div id="pet-box" class="pet-container">
        <img id="pet-img" src="koalasmining.jpg" class="pet-img">
        <div style="position:absolute; bottom:10px; background:rgba(0,0,0,0.5); padding:2px 10px; border-radius:10px; font-size:10px;">LVL 1 FANTASTIC KOALA</div>
    </div>

    <div class="mining-info">
        <div class="info-card">
            <small style="color:var(--yellow)">KLS EARNED</small>
            <h3 id="live-kls">0.000</h3>
        </div>
        <div class="info-card">
            <small style="color:#00ff88">USDT EARNED</small>
            <h3 id="live-usdt">0.00000</h3>
        </div>
    </div>

    <div class="energy-wrap">
        <div style="display:flex; justify-content:space-between; margin-bottom:5px; font-size:12px;">
            <span>ENERGY LIMIT</span>
            <span>âš¡</span>
        </div>
        <div class="bar-bg"><div id="energy-bar"></div></div>
    </div>

    <button id="main-btn" class="btn-play" onclick="toggleMining()">Play / Claim</button>
</div>

</body>
</html>
